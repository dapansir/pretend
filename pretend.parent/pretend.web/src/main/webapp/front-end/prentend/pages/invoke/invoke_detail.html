<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>调用测试列表页面</title>
    <link rel="stylesheet" href="../../bootstrap-3.3.7/css/bootstrap.css">
    <link rel="stylesheet" href="../../bootstrap-table/bootstrap-table.css">
    <link rel="stylesheet" href="../../css/providerlist.css">
    <script src="../../js/jquery/jquery.min.js"></script>
    <script src="../../bootstrap-3.3.7/js/bootstrap.js"></script>
    <script src="../../bootstrap-table/bootstrap-table.js"></script>
    <script src="../../bootstrap-table/bootstrap-table-zh-CN.js"></script>
    <script src="../../js/tool.js"></script>

</head>
<body>
    <div class=".container">
        <div >
        	<div class="table_center">
                <h3></h3>
                <div class="page-header"></div>
                <form class="form-inline">
                    <input type="hidden" name="interfaceName" id="interfaceName" value="org.apache.dubbo.demo.DemoService"/>
                    <input type="hidden" name="method" id="method" value="sayHello"/>
                    <input type="hidden" name="classes" id="classes" value="java.lang.String"/>
                    <input type="hidden" name="address" id="address" value="127.0.0.1:20880">
                    <input type="hidden" name="protocol" id="protocol" value="dubbo">
                    <input type="hidden" name="argNames" id="argNames" value="dubbo">
                    <div class="row" id="connect">
                        <div class="col-sm-offset-5">
                            <a class="btn btn-success" id="doTest">测试</a>
                        </div>
                    </div>
                </form>
        	</div>
        </div>
    </div>
   	<div style="display:none">
		<div class="row" id="tempalte">
			<div class="form-group col-sm-6 col-md-6">
				<label for="class" name="label1" style="width:40%"></label> 
				<input type="text" class="form-control" id="class" placeholder="">
			</div>
			<div class="form-group col-sm-6 col-md-6">
				<label for="class" name="label2" style="width:40%"></label> 
				<input type="text" class="form-control" id="class" placeholder="">
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	var url = decodeURI(window.location.href);
	var data = getAllParameters(url);
	$("h3").html(data.description);
	$.ajax({
		url:"../../../../dubbo/getMethodDetail.do",
		data:JSON.stringify(data),
		type:"post",
		success:function(data){appendElement(data)},
		dataType:"json",
		contentType:"application/json; charset=UTF-8",
		error:function(data){
			alert(data.statusText);
		}
	});
	
	function appendElement(data){
		var res = JSON.parse(data);
		var keys = Object.keys(res);
		var key;
		var value;
		debugger;
		for(var j = 0; j < keys.length; j++ ){
			key = keys[j];
			value = res[key];
			$("<h3></h3>").html(key+":").insertBefore($("#connect"));
			var element = $("#tempalte").clone(false);
			if(typeof value === 'string'){
				$(element).find("[name='label1']").html(value+":");
				$(element).find("[name='label2']").next().remove();
				$(element).find("[name='label2']").remove();
				$(element).insertBefore($("#connect"));
			}
			if(Array.isArray(value)){
				for (var i = 0; i < value.length; i= i+2) {
					var element = $("#tempalte").clone(false);
					$(element).find("[name='label1']").html(value[i].fieldName+":");
					$(element).find("[name='label1']").next().attr("name",value[i].fieldName+":");
					if(i+1 < value.length){
						$(element).find("[name='label2']").html(value[i+1].fieldName+":");
						$(element).find("[name='label2']").next().attr("name",value[i+1].fieldName+":");
					}else{
						$(element).find("[name='label2']").next().remove();
						$(element).find("[name='label2']").remove();
					}
					$(element).insertBefore($("#connect"));
				}	
			}
		}
	}
	
	$("#doTest").on("click",function(){
		var send = $(".form-inline").serializeObject();
		$.ajax({
			url:"../../../../dubbo/doTest.do",
			data:JSON.stringify(send),
			success:function(data) {
				debugger;
				if (undefined == data || null == data || data.length == 0) {
					console.log("编号:" + id + "未查询到相关接口数据");
					return;
				}
				alert(data.backMessage);
			},
			contentType:"application/json; charset=UTF-8",
			type:"post",
			dataType:"json"
		});
	});
	
</script>
</html>